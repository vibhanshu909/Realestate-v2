generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["mongoDb", "referentialIntegrity", "interactiveTransactions"]
}

datasource db {
  provider             = "mongodb"
  url                  = env("DATABASE_URL")
  referentialIntegrity = "prisma"
}

model User {
  id String @id @default(dbgenerated()) @map("_id") @db.ObjectId
  v  Int    @map("__v")

  createdAt DateTime @db.Date
  updatedAt DateTime @updatedAt @db.Date

  balance             BigInt
  /// Multiple data types found: Double: 57.1%, Int32: 42.9% out of 7 sampled entries
  contact             BigInt  @default(0)
  history             Json[]
  password            String
  isAdmin             Boolean @default(false)
  sites               Site[]
  spent               BigInt
  totalReceivedAmount BigInt
  username            String  @unique(map: "username_1")

  newHistory History[]
  activities Activity[]
  @@map("users")
}

enum HistoryType {
  CREDIT
  DEBIT
}

model History {
  id        String   @id @default(dbgenerated()) @map("_id") @db.ObjectId
  v         Int      @map("__v")
  createdAt DateTime @db.Date
  updatedAt DateTime @updatedAt @db.Date

  type    HistoryType
  amount  BigInt
  balance BigInt

  userId String @db.ObjectId
  user   User   @relation(fields: [userId], references: [id])

  @@map("history")
}

model Site {
  id String @id @default(dbgenerated()) @map("_id") @db.ObjectId
  v  Int    @map("__v")

  createdAt DateTime @db.Date
  updatedAt DateTime @updatedAt @db.Date

  cost               BigInt
  isDeleted          Boolean
  location           String
  manager            User    @relation(fields: [id], references: [id])
  managerSpentAmount BigInt
  name               String  @unique(map: "name_1")
  total              Json

  siteEntries SiteEntry[]

  @@map("sites")
}

model SiteEntry {
  id String @id @default(dbgenerated()) @map("_id") @db.ObjectId
  v  Int    @map("__v")

  createdAt DateTime @db.Date
  updatedAt DateTime @updatedAt @db.Date

  mistri Json
  labour Json
  eit    Json
  morang Json
  baalu  Json
  githi  Json
  cement Json
  saria  Json
  dust   Json
  other  Json
  other2 Json
  note   String?

  managerSpentAmount BigInt
  total              BigInt

  siteId String @db.ObjectId
  site   Site   @relation(fields: [siteId], references: [id])

  @@index([createdAt], map: "createdAt_1")
  @@map("siteentries")
}

model Activity {
  id String @id @default(dbgenerated()) @map("_id") @db.ObjectId
  v  Int    @map("__v")

  createdAt DateTime @db.Date
  updatedAt DateTime @updatedAt @db.Date

  activity  String
  arguments Json
  result    Json

  userId String @db.ObjectId
  user   User   @relation(fields: [userId], references: [id])
  @@map("activities")
}
